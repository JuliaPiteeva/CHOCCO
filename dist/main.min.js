////////////////Секция map////////////////////////////////////////////////////////////////////////////////

let myMap;

const init = () => {
  myMap = new ymaps.Map("map", {
    center: [55.76, 37.65],
    zoom: 13,
    controls: ["zoomControl", "routeButtonControl"],
  });
  control = myMap.controls.get("routeButtonControl");
  control.routePanel.state.set("from", "улица Новый Арбат");

  const coords = [
    [55.74, 37.63],
    [55.77, 37.64],
    [55.76, 37.65],
    [55.75, 37.66],
  ];
  const myCollection = new ymaps.GeoObjectCollection(
    {},
    {
      draggable: false, // и их можно перемещать
      iconLayout: "default#image",
      iconImageHref: "./img/mark.png",
      iconImageSize: [30, 42],
      iconImageOffset: [-3, -42],
      zoom: 10,
    }
  );
  coords.forEach((coord) => {
    myCollection.add(new ymaps.Placemark(coord));
  });

  myMap.geoObjects.add(myCollection);
  myMap.behaviors.disable("scrollZoom");
};
ymaps.ready(init);

////////////////Секция с плеером////////////////////////////////////////////////////////////////////////////////

var vid = document.getElementById("videoID");

vid.oncanplay = function () {
  //видео готово к воспроизведению
  const playerStartBtn = document.querySelector(".player__start");
  const playerContainer = document.querySelector(".player");
  const splashScreen = document.querySelector(".player__splash"); //select screen saver

  /////////////////////////////////////////Запуск/////////////////////////////////////////////////////////////
  playerStartBtn.addEventListener("click", function (event) {
    event.preventDefault();
    playerContainer.classList.contains("paused") ? vid.pause() : vid.play();
  });

  splashScreen.addEventListener("click", function (event) {
    //handle the click
    vid.play();
  });

  //////////////////////////////перемещаем ползунок при воспроизведении, опрашивая видео каждую секунду//////////
  const playbackBtn = document.getElementById("playbackButtonId");

  var interval = setInterval(() => {
    const durationSec = vid.duration;
    const currentTimeSec = vid.currentTime;
    const curTimePer = countPercent(currentTimeSec, durationSec);

    moveBtn(playbackBtn, curTimePer);
    
  }, 1000);


  ///////////////////////////передвигаем ползунок и перематываем видео/////////////////////////////////////////
  const playerPlaybackContainer = document.querySelector(".player__playback");

  playerPlaybackContainer.addEventListener("click", function (e) {
    const bar = e.target; //catch event on container
    const barWidth = parseInt(getComputedStyle(bar).width); //get width
    const clickedPosition = e.layerX; //save click point
    const duration = vid.duration;

    const newBtnPositionPer = countPercent(clickedPosition, barWidth);
    moveBtn(playbackBtn, newBtnPositionPer); //change position

    vid.currentTime = countLevelPositionSec(duration, newBtnPositionPer); // rewind video
  });

  ////////////////////////////Управление громкостью//////////////////////////////////
  const playerVolumeContainer = document.querySelector(".player__volume-level");
  const playerVolumeBtn = document.querySelector(".player__volume-btn");
  const volume = 0.5; //Значение по умолчанию:	1.0 https://www.w3schools.com/tags/av_prop_volume.asp

  /////////////устанавливаем стартовое значение
  playerVolumeBtn.style.left = volume * 100 + "%"; //установим громкость

  ////////////обрабатываем клики по шкале
  playerVolumeContainer.addEventListener("click", function (e) {
    const barVolume = e.target;
    const barVolumeWidth = parseInt(getComputedStyle(barVolume).width); //get width
    const clickedPosition = e.layerX; //save click point
    const newVolumeBtnPositionPer = countPercent(
      clickedPosition,
      barVolumeWidth
    ); //conversion

    moveBtn(playerVolumeBtn, newVolumeBtnPositionPer); //move btn

    vid.volume = countLevelPositionSec(volume, newVolumeBtnPositionPer); // rewind volume
  });

  //////////////////////////////////////////выключить звук///////////////////////////////////////////////////////
  const playerVolumeIcon = document.querySelector(".player__volume-icon");

  playerVolumeIcon.addEventListener("click", function (e) {
    if (!playerVolumeIcon.classList.contains("silent")) {
      vid.volume = 0;
      playerVolumeIcon.classList.add("silent");
      moveBtn(playerVolumeBtn, vid.volume);
    } else {
      vid.volume = 0.5;
      let val = vid.volume * 100;
      moveBtn(playerVolumeBtn, val);
      playerVolumeIcon.classList.remove("silent");
    }
  });

  ///////////Count Function/////////////////////////////////////////////////////////////////////////////////////////
  const moveBtn = function (btn, value) {
    btn.style.left = value + "%";
  };
  const countPercent = function (clickedPosition, blockWidth) {
    return (clickedPosition / blockWidth) * 100;
  };
  const countLevelPositionSec = function (generalValue, percentValue) {
    return (generalValue / 100) * percentValue;
  };

  ///////////////////////Cмену классов - централизовано //////////////////////////////////////////////////////////////////
  vid.onplay = function () {
    playerContainer.classList.add("active");
    playerContainer.classList.add("paused");
  };

  vid.onpause = function () {
    playerContainer.classList.remove("paused");
    playerContainer.classList.remove("active");
  };
};

/////////////////// Секция "hero" открытие и закрытие полноэкранного меню//////////////////
const hamburgerOpen = document.querySelector(".hamburger-link");
var hamburgerMenu = document.querySelector(".hamburger-menu");
hamburgerOpen.addEventListener("click", function (e) {
  e.preventDefault();
  hamburgerMenu.style.display = "block";
});

const hamburgerClose = document.querySelector(".svg-container");
hamburgerMenu = document.querySelector(".hamburger-menu");

hamburgerClose.addEventListener("click", function () {
  hamburgerMenu.style.display = "none";
});

///////////////// Секция "slider" , кеопка состава батончика//////////////////////////

const nutritionLinks = document.querySelectorAll(".bar__nutrition-link");
const nutritionShows = document.querySelectorAll(".nutrition");

for (var i = 0; i < nutritionLinks.length; i++) {
  nutritionLinks[i].addEventListener("click", function (e) {
    e.preventDefault();
    this.nextElementSibling.classList.toggle("nutrition--active");
  });
}

///////////////////////// Секция "menu" аккордеон/////////////////////////////////

const menulinkArray = document.getElementsByClassName("menu__link");
const menuContentArray = document.getElementsByClassName("menu__desc-content");
const closeBtn = document.getElementsByClassName("close");

for (var i = 0; i < menulinkArray.length; i++) {
  menulinkArray[i].addEventListener("click", function (e) {
    e.preventDefault();
    const thisActive = this.nextElementSibling;
    for (var k = 0; k < menuContentArray.length; k++) {
      if (
        k != i &&
        !thisActive.classList.contains("menu__desc-content--active")
      ) {
        menuContentArray[k].classList.remove("menu__desc-content--active");
      }
    }
    if (!thisActive.classList.contains("menu__desc-content--active")) {
      thisActive.classList.add("menu__desc-content--active");
    } else {
      thisActive.classList.remove("menu__desc-content--active");
    }
  });
}

var menuContentCloseArray = document.getElementsByClassName("close");
for (var i = 0; i < menuContentCloseArray.length; i++) {
  menuContentCloseArray[i].addEventListener("click", function (e) {
    var closeDesc = this.parentNode;
    var closeDesc2 = closeDesc.parentNode;
    closeDesc2.classList.remove("menu__desc-content--active");
  });
}
////////////////////////Секция "team" аккордеон///////////////////////////
const teamLinkArray = document.getElementsByClassName("accordeon__title");
const accordeonIitem = document.getElementsByClassName("accordeon__item");

for (var i = 0; i < teamLinkArray.length; i++) {
  teamLinkArray[i].addEventListener("click", function (e) {
    e.preventDefault();
    const thisActive = this.parentNode;
    for (var k = 0; k < accordeonIitem.length; k++) {
      if (k != i && !thisActive.classList.contains("accordeon--visible")) {
        accordeonIitem[k].classList.remove("accordeon--visible");
      }
    }
    if (!thisActive.classList.contains("accordeon--visible")) {
      thisActive.classList.add("accordeon--visible");
    } else {
      thisActive.classList.remove("accordeon--visible");
    }
  });
}

///////////////////////////////Отправка данных из формы на сервер///////////////////////////////////////

const myForm = document.querySelector("#form");
const send = document.querySelector(".button");
const body = document.querySelector("body");

send.addEventListener("click", function (event) {
  event.preventDefault();
  if (validateForm(myForm)) {
    //создаем объект с введенными данными
    var formData = new FormData();
    formData.append("name", myForm.elements.phone.value);
    formData.append("phone", myForm.elements.phone.value);
    formData.append("comment", myForm.elements.comment.value);
    formData.append("to", "a@a.a");

    const xhr = new XMLHttpRequest();
    xhr.responseType = "json"; //будем ожидать от сервера, данные в формате json
    xhr.open("POST", "https://webdev-api.loftschool.com/sendmail"); // метод отправки, путь до сервера
    xhr.send(formData); // - метод, выполняет ф-ю отправки указанных данных. Переводим наш объект в строку и отправляем
    xhr.addEventListener("load", () => {
      if (xhr.response.status) {
        //в случае успеха, выражение вернет true
        overlay.open();
        body.classList.add("lock");
        overlay.setContent("Сообщение отправлено");

        myForm.elements.name.value = "";
        myForm.elements.phone.value = "";
        myForm.elements.comment.value = "";
      } else {
        overlay.open();
        body.classList.add("lock");
        overlay.setContent(xhr.response.message);
      }
    });
  }
});

function validateForm(form) {
  let valid = true;

  if (!validateField(form.elements.name)) {
    valid = false;
  }
  if (!validateField(form.elements.phone)) {
    valid = false;
  }
  if (!validateField(form.elements.comment)) {
    valid = false;
  }
  return valid;
}
function validateField(field) {
  field.nextElementSibling.textContent = field.validationMessage;
  return field.checkValidity();
}

/////////////////////////////////////OVERLAY//////////////////////////////////////////

const template = document.querySelector("#overlayTemplate").innerHTML;
const overlay = createOverlay(template);
overlay.setContent("Сообщение отправлено");

function createOverlay(template) {
  const fragment = document.createElement("div"); //создаем временный контейнер

  fragment.innerHTML = template; //Помещаем во временный контейнер шаблон

  const overlayElement = fragment.querySelector(".overlay");
  const contentElement = fragment.querySelector(".content");
  const closeElement = fragment.querySelector(".overlay-close");

  overlayElement.addEventListener("click", (e) => {
    if (e.target === overlayElement) {
      closeElement.click(); //эмулируем нажатие на кнопку закрыть
    }
  });

  closeElement.addEventListener("click", (e) => {
    e.preventDefault();
    document.body.removeChild(overlayElement);
    body.classList.remove("lock");
  });

  return {
    open() {
      document.body.appendChild(overlayElement);
    },
    close() {
      closeElement.click();
    },
    setContent(content) {
      contentElement.innerHTML = content;
    },
  };
}
///////////////////////reviews/////////////////////////////////////////////////////

const leftIcon = document.querySelector("#left");
const middleIcon = document.querySelector("#middle");
const rightIcon = document.querySelector("#right");
const reviewsItems = document.querySelectorAll(".reviews__item");
const links = document.querySelectorAll(".reviews__link");

var slideIndex = 1;

leftIcon.addEventListener("click", function (e) {
  e.preventDefault();
  slideIndex = 0;
  showSlides(slideIndex);
});

middleIcon.addEventListener("click", function (e) {
  e.preventDefault();
  slideIndex = 1;
  showSlides(slideIndex);
});

rightIcon.addEventListener("click", function (e) {
  e.preventDefault();
  slideIndex = 2;
  showSlides(slideIndex);
});

function showSlides(index) {
  for (var i = 0; i < reviewsItems.length; i++) {
    if (
      reviewsItems[i].classList.contains("reviews__item--active") &&
      links[i].classList.contains("reviews__link--active")
    ) {
      reviewsItems[i].classList.remove("reviews__item--active");
      links[i].classList.remove("reviews__link--active");
    }
    reviewsItems[index].classList.add("reviews__item--active");
    links[index].classList.add("reviews__link--active");
  }
}
var k = 0;
var timerId = setInterval(function () {
  showSlides(k);
  k++;
  if (k === 3) {
    k = 0;
  }
}, 3000);

////////////////OnePageScroll////////////////////////////////////////////////////////////////////////////////

//1.Избавляемся от обычного скролла -  wrapper  - растягиваем тоолько на 100% высоты окна,
//hidden. maincontent - высоту 100%б его и будем двигать.
//2.Комплексную задачу - разбиваем на простые подзадачи
//3. Определяем, вверх скролим или вниз
//4.Определить, какая секция отображена. Текущая секция - наличие класса active
//5.Фукнция -которая будет определять куда скролить.
//6.Необходимо смещать активный класс
//7.Не можем скролить к несуществующим секциям.
//8. Перед скролом проверим, есть ли наша секция
//9. Тачпад генерирует много событий. Частые события.
//10. mobbile-detect js - библиотека. определить устройство и применить методы

const sections = $(".section");
const display = $(".maincontent");
let inScroll = false;
const md = new MobileDetect(window.navigator.userAgent);
const isMobile = md.mobile();

const countSectionPosition = (sectionEq) => {
  const position = sectionEq * -100;
  if (isNaN(position))
    console.error("Не верное значение в функции countSectionPosition");
  return position;
};

const resetActiveClass = (item, eq) => {
  item.eq(eq).addClass("active").siblings().removeClass("active");
};

const performTransition = (sectionEq) => {
  if (inScroll) return;
  inScroll = true;
  resetActiveClass(sections, sectionEq);
  resetActiveClass($(".point-nav__item"), sectionEq);
  display.css({
    transform: `translateY(${countSectionPosition(sectionEq)}%)`,
  });

  const transformEnded = display.on("transformend").length;
  if (transformEnded) {
    inScroll = false;
  }
};

const scroller = () => {
  const activeSection = sections.filter(".active");
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  return {
    //объект с методами
    next() {
      if (nextSection.length) {
        //если есть секция, скроллим к ней
        performTransition(nextSection.index());
      }
    },
    prev() {
      if (prevSection.length) {
        performTransition(prevSection.index());
      }
    },
  };
};

$(window).on("wheel", (e) => {
  const deltaY = e.originalEvent.deltaY;
  const windowScroller = scroller();

  if (deltaY > 0) {
    windowScroller.next();
  }

  if (deltaY < 0) {
    windowScroller.prev();
  }
});

//////////////////////////////////// при нажатии на клавиши вверх/вниз/////////////////////////
//Убедимся, что нажатие кнопок произошло body
//Определяем блок с произошедшим событием. target-возвращает блок, на котором произошло событие, смотреть регистр
$(document).on("keydown", (e) => {
  const windowScroller = scroller();
  const tagName = e.target.tagName.toLowerCase();
  const userTypingInInputs = tagName === "input" || tagName === "textarea";

  if (userTypingInInputs) return;
  switch (e.keyCode) {
    case 38:
      windowScroller.prev();
      break;
    case 40:
      windowScroller.next();
      break;
  }
});

//////////////////////////////////переход по ссылкам и точкам////////////////////////
//Разные кнопки, по которым происходят одни и теже действия. Заводим дата атрибут data-scroll-to, с айди или классом.
//e.currentTarget значение элемента, на который событие было навешано
// attr берем номер секци куда скролить
$("[data-scroll-to]").on("click", (e) => {
  e.preventDefault();
  const $this = $(e.currentTarget);
  const target = $this.attr("data-scroll-to");
  performTransition(target);
});
//touchstart? touchmove, touchhend - можно реализовать перетягивание  drak
// реализация с помощью библиотеки  touchswipe
//добавляем условие проверки устройства
if (isMobile) {
  $("body").swipe({
    swipe: (event, direction) => {
      let scrollDirection;
      const windowScroller = scroller();

      if (direction === "up") scrollDirection = "next";
      if (direction === "down") scrollDirection = "prev";

      windowScroller[scrollDirection]();
    },
  });
}
// код не должен расти вправо, понятные имена переменных, не создавать длинных усовий, можно вынесли условие в переменную
//функция должна выполнять одну операцию
//проверять входные параметры, писать подсказки
//внутри функции приводить аргументы к нужным типам данных
//не доускать магических чисел
//следить за дубликацией кода

const left = document.querySelector(".left__link");
const right = document.querySelector(".right__link");
const items = document.querySelector(".slider__list");

right.addEventListener("click", function (e) {
  e.preventDefault();
  loop("right", e);
});

left.addEventListener("click", function (e) {
  e.preventDefault();
  loop("left", e);
});

function loop(direction, e) {
  e.preventDefault();
  if (direction === "right") {
    items.appendChild(items.firstElementChild);
  } else {
    items.insertBefore(items.lastElementChild, items.firstElementChild);
  }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsInBsYXllci5qcyIsInNjcmlwdC5qcyIsInNjcm9sbC5qcyIsInNsaWRlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcE9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25JQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vLy8vLy8vLy8vLy8vL9Ch0LXQutGG0LjRjyBtYXAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxubGV0IG15TWFwO1xyXG5cclxuY29uc3QgaW5pdCA9ICgpID0+IHtcclxuICBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xyXG4gICAgY2VudGVyOiBbNTUuNzYsIDM3LjY1XSxcclxuICAgIHpvb206IDEzLFxyXG4gICAgY29udHJvbHM6IFtcInpvb21Db250cm9sXCIsIFwicm91dGVCdXR0b25Db250cm9sXCJdLFxyXG4gIH0pO1xyXG4gIGNvbnRyb2wgPSBteU1hcC5jb250cm9scy5nZXQoXCJyb3V0ZUJ1dHRvbkNvbnRyb2xcIik7XHJcbiAgY29udHJvbC5yb3V0ZVBhbmVsLnN0YXRlLnNldChcImZyb21cIiwgXCLRg9C70LjRhtCwINCd0L7QstGL0Lkg0JDRgNCx0LDRglwiKTtcclxuXHJcbiAgY29uc3QgY29vcmRzID0gW1xyXG4gICAgWzU1Ljc0LCAzNy42M10sXHJcbiAgICBbNTUuNzcsIDM3LjY0XSxcclxuICAgIFs1NS43NiwgMzcuNjVdLFxyXG4gICAgWzU1Ljc1LCAzNy42Nl0sXHJcbiAgXTtcclxuICBjb25zdCBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbihcclxuICAgIHt9LFxyXG4gICAge1xyXG4gICAgICBkcmFnZ2FibGU6IGZhbHNlLCAvLyDQuCDQuNGFINC80L7QttC90L4g0L/QtdGA0LXQvNC10YnQsNGC0YxcclxuICAgICAgaWNvbkxheW91dDogXCJkZWZhdWx0I2ltYWdlXCIsXHJcbiAgICAgIGljb25JbWFnZUhyZWY6IFwiLi9pbWcvbWFyay5wbmdcIixcclxuICAgICAgaWNvbkltYWdlU2l6ZTogWzMwLCA0Ml0sXHJcbiAgICAgIGljb25JbWFnZU9mZnNldDogWy0zLCAtNDJdLFxyXG4gICAgICB6b29tOiAxMCxcclxuICAgIH1cclxuICApO1xyXG4gIGNvb3Jkcy5mb3JFYWNoKChjb29yZCkgPT4ge1xyXG4gICAgbXlDb2xsZWN0aW9uLmFkZChuZXcgeW1hcHMuUGxhY2VtYXJrKGNvb3JkKSk7XHJcbiAgfSk7XHJcblxyXG4gIG15TWFwLmdlb09iamVjdHMuYWRkKG15Q29sbGVjdGlvbik7XHJcbiAgbXlNYXAuYmVoYXZpb3JzLmRpc2FibGUoXCJzY3JvbGxab29tXCIpO1xyXG59O1xyXG55bWFwcy5yZWFkeShpbml0KTtcclxuIiwiLy8vLy8vLy8vLy8vLy8vL9Ch0LXQutGG0LjRjyDRgSDQv9C70LXQtdGA0L7QvC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG52YXIgdmlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0lEXCIpO1xyXG5cclxudmlkLm9uY2FucGxheSA9IGZ1bmN0aW9uICgpIHtcclxuICAvL9Cy0LjQtNC10L4g0LPQvtGC0L7QstC+INC6INCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjRjlxyXG4gIGNvbnN0IHBsYXllclN0YXJ0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJfX3N0YXJ0XCIpO1xyXG4gIGNvbnN0IHBsYXllckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyXCIpO1xyXG4gIGNvbnN0IHNwbGFzaFNjcmVlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX19zcGxhc2hcIik7IC8vc2VsZWN0IHNjcmVlbiBzYXZlclxyXG5cclxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL9CX0LDQv9GD0YHQui8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICBwbGF5ZXJTdGFydEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgcGxheWVyQ29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucyhcInBhdXNlZFwiKSA/IHZpZC5wYXVzZSgpIDogdmlkLnBsYXkoKTtcclxuICB9KTtcclxuXHJcbiAgc3BsYXNoU2NyZWVuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIC8vaGFuZGxlIHRoZSBjbGlja1xyXG4gICAgdmlkLnBsYXkoKTtcclxuICB9KTtcclxuXHJcbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v0L/QtdGA0LXQvNC10YnQsNC10Lwg0L/QvtC70LfRg9C90L7QuiDQv9GA0Lgg0LLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC4LCDQvtC/0YDQsNGI0LjQstCw0Y8g0LLQuNC00LXQviDQutCw0LbQtNGD0Y4g0YHQtdC60YPQvdC00YMvLy8vLy8vLy8vXHJcbiAgY29uc3QgcGxheWJhY2tCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsYXliYWNrQnV0dG9uSWRcIik7XHJcblxyXG4gIHZhciBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgIGNvbnN0IGR1cmF0aW9uU2VjID0gdmlkLmR1cmF0aW9uO1xyXG4gICAgY29uc3QgY3VycmVudFRpbWVTZWMgPSB2aWQuY3VycmVudFRpbWU7XHJcbiAgICBjb25zdCBjdXJUaW1lUGVyID0gY291bnRQZXJjZW50KGN1cnJlbnRUaW1lU2VjLCBkdXJhdGlvblNlYyk7XHJcblxyXG4gICAgbW92ZUJ0bihwbGF5YmFja0J0biwgY3VyVGltZVBlcik7XHJcbiAgICBcclxuICB9LCAxMDAwKTtcclxuXHJcblxyXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL9C/0LXRgNC10LTQstC40LPQsNC10Lwg0L/QvtC70LfRg9C90L7QuiDQuCDQv9C10YDQtdC80LDRgtGL0LLQsNC10Lwg0LLQuNC00LXQvi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgY29uc3QgcGxheWVyUGxheWJhY2tDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllcl9fcGxheWJhY2tcIik7XHJcblxyXG4gIHBsYXllclBsYXliYWNrQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgY29uc3QgYmFyID0gZS50YXJnZXQ7IC8vY2F0Y2ggZXZlbnQgb24gY29udGFpbmVyXHJcbiAgICBjb25zdCBiYXJXaWR0aCA9IHBhcnNlSW50KGdldENvbXB1dGVkU3R5bGUoYmFyKS53aWR0aCk7IC8vZ2V0IHdpZHRoXHJcbiAgICBjb25zdCBjbGlja2VkUG9zaXRpb24gPSBlLmxheWVyWDsgLy9zYXZlIGNsaWNrIHBvaW50XHJcbiAgICBjb25zdCBkdXJhdGlvbiA9IHZpZC5kdXJhdGlvbjtcclxuXHJcbiAgICBjb25zdCBuZXdCdG5Qb3NpdGlvblBlciA9IGNvdW50UGVyY2VudChjbGlja2VkUG9zaXRpb24sIGJhcldpZHRoKTtcclxuICAgIG1vdmVCdG4ocGxheWJhY2tCdG4sIG5ld0J0blBvc2l0aW9uUGVyKTsgLy9jaGFuZ2UgcG9zaXRpb25cclxuXHJcbiAgICB2aWQuY3VycmVudFRpbWUgPSBjb3VudExldmVsUG9zaXRpb25TZWMoZHVyYXRpb24sIG5ld0J0blBvc2l0aW9uUGVyKTsgLy8gcmV3aW5kIHZpZGVvXHJcbiAgfSk7XHJcblxyXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy/Qo9C/0YDQsNCy0LvQtdC90LjQtSDQs9GA0L7QvNC60L7RgdGC0YzRji8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICBjb25zdCBwbGF5ZXJWb2x1bWVDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllcl9fdm9sdW1lLWxldmVsXCIpO1xyXG4gIGNvbnN0IHBsYXllclZvbHVtZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX192b2x1bWUtYnRuXCIpO1xyXG4gIGNvbnN0IHZvbHVtZSA9IDAuNTsgLy/Ql9C90LDRh9C10L3QuNC1INC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOOlx0MS4wIGh0dHBzOi8vd3d3Lnczc2Nob29scy5jb20vdGFncy9hdl9wcm9wX3ZvbHVtZS5hc3BcclxuXHJcbiAgLy8vLy8vLy8vLy8vL9GD0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INGB0YLQsNGA0YLQvtCy0L7QtSDQt9C90LDRh9C10L3QuNC1XHJcbiAgcGxheWVyVm9sdW1lQnRuLnN0eWxlLmxlZnQgPSB2b2x1bWUgKiAxMDAgKyBcIiVcIjsgLy/Rg9GB0YLQsNC90L7QstC40Lwg0LPRgNC+0LzQutC+0YHRgtGMXHJcblxyXG4gIC8vLy8vLy8vLy8vL9C+0LHRgNCw0LHQsNGC0YvQstCw0LXQvCDQutC70LjQutC4INC/0L4g0YjQutCw0LvQtVxyXG4gIHBsYXllclZvbHVtZUNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgIGNvbnN0IGJhclZvbHVtZSA9IGUudGFyZ2V0O1xyXG4gICAgY29uc3QgYmFyVm9sdW1lV2lkdGggPSBwYXJzZUludChnZXRDb21wdXRlZFN0eWxlKGJhclZvbHVtZSkud2lkdGgpOyAvL2dldCB3aWR0aFxyXG4gICAgY29uc3QgY2xpY2tlZFBvc2l0aW9uID0gZS5sYXllclg7IC8vc2F2ZSBjbGljayBwb2ludFxyXG4gICAgY29uc3QgbmV3Vm9sdW1lQnRuUG9zaXRpb25QZXIgPSBjb3VudFBlcmNlbnQoXHJcbiAgICAgIGNsaWNrZWRQb3NpdGlvbixcclxuICAgICAgYmFyVm9sdW1lV2lkdGhcclxuICAgICk7IC8vY29udmVyc2lvblxyXG5cclxuICAgIG1vdmVCdG4ocGxheWVyVm9sdW1lQnRuLCBuZXdWb2x1bWVCdG5Qb3NpdGlvblBlcik7IC8vbW92ZSBidG5cclxuXHJcbiAgICB2aWQudm9sdW1lID0gY291bnRMZXZlbFBvc2l0aW9uU2VjKHZvbHVtZSwgbmV3Vm9sdW1lQnRuUG9zaXRpb25QZXIpOyAvLyByZXdpbmQgdm9sdW1lXHJcbiAgfSk7XHJcblxyXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL9Cy0YvQutC70Y7Rh9C40YLRjCDQt9Cy0YPQui8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICBjb25zdCBwbGF5ZXJWb2x1bWVJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJfX3ZvbHVtZS1pY29uXCIpO1xyXG5cclxuICBwbGF5ZXJWb2x1bWVJY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgaWYgKCFwbGF5ZXJWb2x1bWVJY29uLmNsYXNzTGlzdC5jb250YWlucyhcInNpbGVudFwiKSkge1xyXG4gICAgICB2aWQudm9sdW1lID0gMDtcclxuICAgICAgcGxheWVyVm9sdW1lSWNvbi5jbGFzc0xpc3QuYWRkKFwic2lsZW50XCIpO1xyXG4gICAgICBtb3ZlQnRuKHBsYXllclZvbHVtZUJ0biwgdmlkLnZvbHVtZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB2aWQudm9sdW1lID0gMC41O1xyXG4gICAgICBsZXQgdmFsID0gdmlkLnZvbHVtZSAqIDEwMDtcclxuICAgICAgbW92ZUJ0bihwbGF5ZXJWb2x1bWVCdG4sIHZhbCk7XHJcbiAgICAgIHBsYXllclZvbHVtZUljb24uY2xhc3NMaXN0LnJlbW92ZShcInNpbGVudFwiKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgLy8vLy8vLy8vLy9Db3VudCBGdW5jdGlvbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgY29uc3QgbW92ZUJ0biA9IGZ1bmN0aW9uIChidG4sIHZhbHVlKSB7XHJcbiAgICBidG4uc3R5bGUubGVmdCA9IHZhbHVlICsgXCIlXCI7XHJcbiAgfTtcclxuICBjb25zdCBjb3VudFBlcmNlbnQgPSBmdW5jdGlvbiAoY2xpY2tlZFBvc2l0aW9uLCBibG9ja1dpZHRoKSB7XHJcbiAgICByZXR1cm4gKGNsaWNrZWRQb3NpdGlvbiAvIGJsb2NrV2lkdGgpICogMTAwO1xyXG4gIH07XHJcbiAgY29uc3QgY291bnRMZXZlbFBvc2l0aW9uU2VjID0gZnVuY3Rpb24gKGdlbmVyYWxWYWx1ZSwgcGVyY2VudFZhbHVlKSB7XHJcbiAgICByZXR1cm4gKGdlbmVyYWxWYWx1ZSAvIDEwMCkgKiBwZXJjZW50VmFsdWU7XHJcbiAgfTtcclxuXHJcbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9D0LzQtdC90YMg0LrQu9Cw0YHRgdC+0LIgLSDRhtC10L3RgtGA0LDQu9C40LfQvtCy0LDQvdC+IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gIHZpZC5vbnBsYXkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwbGF5ZXJDb250YWluZXIuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcclxuICAgIHBsYXllckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwicGF1c2VkXCIpO1xyXG4gIH07XHJcblxyXG4gIHZpZC5vbnBhdXNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGxheWVyQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJwYXVzZWRcIik7XHJcbiAgICBwbGF5ZXJDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcclxuICB9O1xyXG59O1xyXG4iLCIvLy8vLy8vLy8vLy8vLy8vLy8vINCh0LXQutGG0LjRjyBcImhlcm9cIiDQvtGC0LrRgNGL0YLQuNC1INC4INC30LDQutGA0YvRgtC40LUg0L/QvtC70L3QvtGN0LrRgNCw0L3QvdC+0LPQviDQvNC10L3Rji8vLy8vLy8vLy8vLy8vLy8vL1xyXG5jb25zdCBoYW1idXJnZXJPcGVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5oYW1idXJnZXItbGlua1wiKTtcclxudmFyIGhhbWJ1cmdlck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmhhbWJ1cmdlci1tZW51XCIpO1xyXG5oYW1idXJnZXJPcGVuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBoYW1idXJnZXJNZW51LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbn0pO1xyXG5cclxuY29uc3QgaGFtYnVyZ2VyQ2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnN2Zy1jb250YWluZXJcIik7XHJcbmhhbWJ1cmdlck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmhhbWJ1cmdlci1tZW51XCIpO1xyXG5cclxuaGFtYnVyZ2VyQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICBoYW1idXJnZXJNZW51LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxufSk7XHJcblxyXG4vLy8vLy8vLy8vLy8vLy8vLyDQodC10LrRhtC40Y8gXCJzbGlkZXJcIiAsINC60LXQvtC/0LrQsCDRgdC+0YHRgtCw0LLQsCDQsdCw0YLQvtC90YfQuNC60LAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuY29uc3QgbnV0cml0aW9uTGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJhcl9fbnV0cml0aW9uLWxpbmtcIik7XHJcbmNvbnN0IG51dHJpdGlvblNob3dzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5udXRyaXRpb25cIik7XHJcblxyXG5mb3IgKHZhciBpID0gMDsgaSA8IG51dHJpdGlvbkxpbmtzLmxlbmd0aDsgaSsrKSB7XHJcbiAgbnV0cml0aW9uTGlua3NbaV0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB0aGlzLm5leHRFbGVtZW50U2libGluZy5jbGFzc0xpc3QudG9nZ2xlKFwibnV0cml0aW9uLS1hY3RpdmVcIik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8g0KHQtdC60YbQuNGPIFwibWVudVwiINCw0LrQutC+0YDQtNC10L7QvS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuY29uc3QgbWVudWxpbmtBcnJheSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJtZW51X19saW5rXCIpO1xyXG5jb25zdCBtZW51Q29udGVudEFycmF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcIm1lbnVfX2Rlc2MtY29udGVudFwiKTtcclxuY29uc3QgY2xvc2VCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiY2xvc2VcIik7XHJcblxyXG5mb3IgKHZhciBpID0gMDsgaSA8IG1lbnVsaW5rQXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICBtZW51bGlua0FycmF5W2ldLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc3QgdGhpc0FjdGl2ZSA9IHRoaXMubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgZm9yICh2YXIgayA9IDA7IGsgPCBtZW51Q29udGVudEFycmF5Lmxlbmd0aDsgaysrKSB7XHJcbiAgICAgIGlmIChcclxuICAgICAgICBrICE9IGkgJiZcclxuICAgICAgICAhdGhpc0FjdGl2ZS5jbGFzc0xpc3QuY29udGFpbnMoXCJtZW51X19kZXNjLWNvbnRlbnQtLWFjdGl2ZVwiKVxyXG4gICAgICApIHtcclxuICAgICAgICBtZW51Q29udGVudEFycmF5W2tdLmNsYXNzTGlzdC5yZW1vdmUoXCJtZW51X19kZXNjLWNvbnRlbnQtLWFjdGl2ZVwiKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzQWN0aXZlLmNsYXNzTGlzdC5jb250YWlucyhcIm1lbnVfX2Rlc2MtY29udGVudC0tYWN0aXZlXCIpKSB7XHJcbiAgICAgIHRoaXNBY3RpdmUuY2xhc3NMaXN0LmFkZChcIm1lbnVfX2Rlc2MtY29udGVudC0tYWN0aXZlXCIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpc0FjdGl2ZS5jbGFzc0xpc3QucmVtb3ZlKFwibWVudV9fZGVzYy1jb250ZW50LS1hY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbnZhciBtZW51Q29udGVudENsb3NlQXJyYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiY2xvc2VcIik7XHJcbmZvciAodmFyIGkgPSAwOyBpIDwgbWVudUNvbnRlbnRDbG9zZUFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgbWVudUNvbnRlbnRDbG9zZUFycmF5W2ldLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgdmFyIGNsb3NlRGVzYyA9IHRoaXMucGFyZW50Tm9kZTtcclxuICAgIHZhciBjbG9zZURlc2MyID0gY2xvc2VEZXNjLnBhcmVudE5vZGU7XHJcbiAgICBjbG9zZURlc2MyLmNsYXNzTGlzdC5yZW1vdmUoXCJtZW51X19kZXNjLWNvbnRlbnQtLWFjdGl2ZVwiKTtcclxuICB9KTtcclxufVxyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy/QodC10LrRhtC40Y8gXCJ0ZWFtXCIg0LDQutC60L7RgNC00LXQvtC9Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbmNvbnN0IHRlYW1MaW5rQXJyYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiYWNjb3JkZW9uX190aXRsZVwiKTtcclxuY29uc3QgYWNjb3JkZW9uSWl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiYWNjb3JkZW9uX19pdGVtXCIpO1xyXG5cclxuZm9yICh2YXIgaSA9IDA7IGkgPCB0ZWFtTGlua0FycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgdGVhbUxpbmtBcnJheVtpXS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IHRoaXNBY3RpdmUgPSB0aGlzLnBhcmVudE5vZGU7XHJcbiAgICBmb3IgKHZhciBrID0gMDsgayA8IGFjY29yZGVvbklpdGVtLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgIGlmIChrICE9IGkgJiYgIXRoaXNBY3RpdmUuY2xhc3NMaXN0LmNvbnRhaW5zKFwiYWNjb3JkZW9uLS12aXNpYmxlXCIpKSB7XHJcbiAgICAgICAgYWNjb3JkZW9uSWl0ZW1ba10uY2xhc3NMaXN0LnJlbW92ZShcImFjY29yZGVvbi0tdmlzaWJsZVwiKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzQWN0aXZlLmNsYXNzTGlzdC5jb250YWlucyhcImFjY29yZGVvbi0tdmlzaWJsZVwiKSkge1xyXG4gICAgICB0aGlzQWN0aXZlLmNsYXNzTGlzdC5hZGQoXCJhY2NvcmRlb24tLXZpc2libGVcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzQWN0aXZlLmNsYXNzTGlzdC5yZW1vdmUoXCJhY2NvcmRlb24tLXZpc2libGVcIik7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy/QntGC0L/RgNCw0LLQutCwINC00LDQvdC90YvRhSDQuNC3INGE0L7RgNC80Ysg0L3QsCDRgdC10YDQstC10YAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbmNvbnN0IG15Rm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZm9ybVwiKTtcclxuY29uc3Qgc2VuZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYnV0dG9uXCIpO1xyXG5jb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIik7XHJcblxyXG5zZW5kLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGlmICh2YWxpZGF0ZUZvcm0obXlGb3JtKSkge1xyXG4gICAgLy/RgdC+0LfQtNCw0LXQvCDQvtCx0YrQtdC60YIg0YEg0LLQstC10LTQtdC90L3Ri9C80Lgg0LTQsNC90L3Ri9C80LhcclxuICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKFwibmFtZVwiLCBteUZvcm0uZWxlbWVudHMucGhvbmUudmFsdWUpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKFwicGhvbmVcIiwgbXlGb3JtLmVsZW1lbnRzLnBob25lLnZhbHVlKTtcclxuICAgIGZvcm1EYXRhLmFwcGVuZChcImNvbW1lbnRcIiwgbXlGb3JtLmVsZW1lbnRzLmNvbW1lbnQudmFsdWUpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKFwidG9cIiwgXCJhQGEuYVwiKTtcclxuXHJcbiAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHhoci5yZXNwb25zZVR5cGUgPSBcImpzb25cIjsgLy/QsdGD0LTQtdC8INC+0LbQuNC00LDRgtGMINC+0YIg0YHQtdGA0LLQtdGA0LAsINC00LDQvdC90YvQtSDQsiDRhNC+0YDQvNCw0YLQtSBqc29uXHJcbiAgICB4aHIub3BlbihcIlBPU1RcIiwgXCJodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWxcIik7IC8vINC80LXRgtC+0LQg0L7RgtC/0YDQsNCy0LrQuCwg0L/Rg9GC0Ywg0LTQviDRgdC10YDQstC10YDQsFxyXG4gICAgeGhyLnNlbmQoZm9ybURhdGEpOyAvLyAtINC80LXRgtC+0LQsINCy0YvQv9C+0LvQvdGP0LXRgiDRhC3RjiDQvtGC0L/RgNCw0LLQutC4INGD0LrQsNC30LDQvdC90YvRhSDQtNCw0L3QvdGL0YUuINCf0LXRgNC10LLQvtC00LjQvCDQvdCw0Ygg0L7QsdGK0LXQutGCINCyINGB0YLRgNC+0LrRgyDQuCDQvtGC0L/RgNCw0LLQu9GP0LXQvFxyXG4gICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcclxuICAgICAgaWYgKHhoci5yZXNwb25zZS5zdGF0dXMpIHtcclxuICAgICAgICAvL9CyINGB0LvRg9GH0LDQtSDRg9GB0L/QtdGF0LAsINCy0YvRgNCw0LbQtdC90LjQtSDQstC10YDQvdC10YIgdHJ1ZVxyXG4gICAgICAgIG92ZXJsYXkub3BlbigpO1xyXG4gICAgICAgIGJvZHkuY2xhc3NMaXN0LmFkZChcImxvY2tcIik7XHJcbiAgICAgICAgb3ZlcmxheS5zZXRDb250ZW50KFwi0KHQvtC+0LHRidC10L3QuNC1INC+0YLQv9GA0LDQstC70LXQvdC+XCIpO1xyXG5cclxuICAgICAgICBteUZvcm0uZWxlbWVudHMubmFtZS52YWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgbXlGb3JtLmVsZW1lbnRzLnBob25lLnZhbHVlID0gXCJcIjtcclxuICAgICAgICBteUZvcm0uZWxlbWVudHMuY29tbWVudC52YWx1ZSA9IFwiXCI7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgb3ZlcmxheS5vcGVuKCk7XHJcbiAgICAgICAgYm9keS5jbGFzc0xpc3QuYWRkKFwibG9ja1wiKTtcclxuICAgICAgICBvdmVybGF5LnNldENvbnRlbnQoeGhyLnJlc3BvbnNlLm1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gdmFsaWRhdGVGb3JtKGZvcm0pIHtcclxuICBsZXQgdmFsaWQgPSB0cnVlO1xyXG5cclxuICBpZiAoIXZhbGlkYXRlRmllbGQoZm9ybS5lbGVtZW50cy5uYW1lKSkge1xyXG4gICAgdmFsaWQgPSBmYWxzZTtcclxuICB9XHJcbiAgaWYgKCF2YWxpZGF0ZUZpZWxkKGZvcm0uZWxlbWVudHMucGhvbmUpKSB7XHJcbiAgICB2YWxpZCA9IGZhbHNlO1xyXG4gIH1cclxuICBpZiAoIXZhbGlkYXRlRmllbGQoZm9ybS5lbGVtZW50cy5jb21tZW50KSkge1xyXG4gICAgdmFsaWQgPSBmYWxzZTtcclxuICB9XHJcbiAgcmV0dXJuIHZhbGlkO1xyXG59XHJcbmZ1bmN0aW9uIHZhbGlkYXRlRmllbGQoZmllbGQpIHtcclxuICBmaWVsZC5uZXh0RWxlbWVudFNpYmxpbmcudGV4dENvbnRlbnQgPSBmaWVsZC52YWxpZGF0aW9uTWVzc2FnZTtcclxuICByZXR1cm4gZmllbGQuY2hlY2tWYWxpZGl0eSgpO1xyXG59XHJcblxyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vT1ZFUkxBWS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI292ZXJsYXlUZW1wbGF0ZVwiKS5pbm5lckhUTUw7XHJcbmNvbnN0IG92ZXJsYXkgPSBjcmVhdGVPdmVybGF5KHRlbXBsYXRlKTtcclxub3ZlcmxheS5zZXRDb250ZW50KFwi0KHQvtC+0LHRidC10L3QuNC1INC+0YLQv9GA0LDQstC70LXQvdC+XCIpO1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlT3ZlcmxheSh0ZW1wbGF0ZSkge1xyXG4gIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgLy/RgdC+0LfQtNCw0LXQvCDQstGA0LXQvNC10L3QvdGL0Lkg0LrQvtC90YLQtdC50L3QtdGAXHJcblxyXG4gIGZyYWdtZW50LmlubmVySFRNTCA9IHRlbXBsYXRlOyAvL9Cf0L7QvNC10YnQsNC10Lwg0LLQviDQstGA0LXQvNC10L3QvdGL0Lkg0LrQvtC90YLQtdC50L3QtdGAINGI0LDQsdC70L7QvVxyXG5cclxuICBjb25zdCBvdmVybGF5RWxlbWVudCA9IGZyYWdtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3ZlcmxheVwiKTtcclxuICBjb25zdCBjb250ZW50RWxlbWVudCA9IGZyYWdtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGVudFwiKTtcclxuICBjb25zdCBjbG9zZUVsZW1lbnQgPSBmcmFnbWVudC5xdWVyeVNlbGVjdG9yKFwiLm92ZXJsYXktY2xvc2VcIik7XHJcblxyXG4gIG92ZXJsYXlFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4gICAgaWYgKGUudGFyZ2V0ID09PSBvdmVybGF5RWxlbWVudCkge1xyXG4gICAgICBjbG9zZUVsZW1lbnQuY2xpY2soKTsgLy/RjdC80YPQu9C40YDRg9C10Lwg0L3QsNC20LDRgtC40LUg0L3QsCDQutC90L7Qv9C60YMg0LfQsNC60YDRi9GC0YxcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgY2xvc2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5RWxlbWVudCk7XHJcbiAgICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJsb2NrXCIpO1xyXG4gIH0pO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgb3BlbigpIHtcclxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5RWxlbWVudCk7XHJcbiAgICB9LFxyXG4gICAgY2xvc2UoKSB7XHJcbiAgICAgIGNsb3NlRWxlbWVudC5jbGljaygpO1xyXG4gICAgfSxcclxuICAgIHNldENvbnRlbnQoY29udGVudCkge1xyXG4gICAgICBjb250ZW50RWxlbWVudC5pbm5lckhUTUwgPSBjb250ZW50O1xyXG4gICAgfSxcclxuICB9O1xyXG59XHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vcmV2aWV3cy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5jb25zdCBsZWZ0SWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbGVmdFwiKTtcclxuY29uc3QgbWlkZGxlSWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWlkZGxlXCIpO1xyXG5jb25zdCByaWdodEljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JpZ2h0XCIpO1xyXG5jb25zdCByZXZpZXdzSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJldmlld3NfX2l0ZW1cIik7XHJcbmNvbnN0IGxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yZXZpZXdzX19saW5rXCIpO1xyXG5cclxudmFyIHNsaWRlSW5kZXggPSAxO1xyXG5cclxubGVmdEljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIHNsaWRlSW5kZXggPSAwO1xyXG4gIHNob3dTbGlkZXMoc2xpZGVJbmRleCk7XHJcbn0pO1xyXG5cclxubWlkZGxlSWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgc2xpZGVJbmRleCA9IDE7XHJcbiAgc2hvd1NsaWRlcyhzbGlkZUluZGV4KTtcclxufSk7XHJcblxyXG5yaWdodEljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIHNsaWRlSW5kZXggPSAyO1xyXG4gIHNob3dTbGlkZXMoc2xpZGVJbmRleCk7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gc2hvd1NsaWRlcyhpbmRleCkge1xyXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcmV2aWV3c0l0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBpZiAoXHJcbiAgICAgIHJldmlld3NJdGVtc1tpXS5jbGFzc0xpc3QuY29udGFpbnMoXCJyZXZpZXdzX19pdGVtLS1hY3RpdmVcIikgJiZcclxuICAgICAgbGlua3NbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKFwicmV2aWV3c19fbGluay0tYWN0aXZlXCIpXHJcbiAgICApIHtcclxuICAgICAgcmV2aWV3c0l0ZW1zW2ldLmNsYXNzTGlzdC5yZW1vdmUoXCJyZXZpZXdzX19pdGVtLS1hY3RpdmVcIik7XHJcbiAgICAgIGxpbmtzW2ldLmNsYXNzTGlzdC5yZW1vdmUoXCJyZXZpZXdzX19saW5rLS1hY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgICByZXZpZXdzSXRlbXNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoXCJyZXZpZXdzX19pdGVtLS1hY3RpdmVcIik7XHJcbiAgICBsaW5rc1tpbmRleF0uY2xhc3NMaXN0LmFkZChcInJldmlld3NfX2xpbmstLWFjdGl2ZVwiKTtcclxuICB9XHJcbn1cclxudmFyIGsgPSAwO1xyXG52YXIgdGltZXJJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICBzaG93U2xpZGVzKGspO1xyXG4gIGsrKztcclxuICBpZiAoayA9PT0gMykge1xyXG4gICAgayA9IDA7XHJcbiAgfVxyXG59LCAzMDAwKTtcclxuIiwiLy8vLy8vLy8vLy8vLy8vL09uZVBhZ2VTY3JvbGwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuLy8xLtCY0LfQsdCw0LLQu9GP0LXQvNGB0Y8g0L7RgiDQvtCx0YvRh9C90L7Qs9C+INGB0LrRgNC+0LvQu9CwIC0gIHdyYXBwZXIgIC0g0YDQsNGB0YLRj9Cz0LjQstCw0LXQvCDRgtC+0L7Qu9GM0LrQviDQvdCwIDEwMCUg0LLRi9GB0L7RgtGLINC+0LrQvdCwLFxyXG4vL2hpZGRlbi4gbWFpbmNvbnRlbnQgLSDQstGL0YHQvtGC0YMgMTAwJdCxINC10LPQviDQuCDQsdGD0LTQtdC8INC00LLQuNCz0LDRgtGMLlxyXG4vLzIu0JrQvtC80L/Qu9C10LrRgdC90YPRjiDQt9Cw0LTQsNGH0YMgLSDRgNCw0LfQsdC40LLQsNC10Lwg0L3QsCDQv9GA0L7RgdGC0YvQtSDQv9C+0LTQt9Cw0LTQsNGH0LhcclxuLy8zLiDQntC/0YDQtdC00LXQu9GP0LXQvCwg0LLQstC10YDRhSDRgdC60YDQvtC70LjQvCDQuNC70Lgg0LLQvdC40LdcclxuLy80LtCe0L/RgNC10LTQtdC70LjRgtGMLCDQutCw0LrQsNGPINGB0LXQutGG0LjRjyDQvtGC0L7QsdGA0LDQttC10L3QsC4g0KLQtdC60YPRidCw0Y8g0YHQtdC60YbQuNGPIC0g0L3QsNC70LjRh9C40LUg0LrQu9Cw0YHRgdCwIGFjdGl2ZVxyXG4vLzUu0KTRg9C60L3RhtC40Y8gLdC60L7RgtC+0YDQsNGPINCx0YPQtNC10YIg0L7Qv9GA0LXQtNC10LvRj9GC0Ywg0LrRg9C00LAg0YHQutGA0L7Qu9C40YLRjC5cclxuLy82LtCd0LXQvtCx0YXQvtC00LjQvNC+INGB0LzQtdGJ0LDRgtGMINCw0LrRgtC40LLQvdGL0Lkg0LrQu9Cw0YHRgVxyXG4vLzcu0J3QtSDQvNC+0LbQtdC8INGB0LrRgNC+0LvQuNGC0Ywg0Log0L3QtdGB0YPRidC10YHRgtCy0YPRjtGJ0LjQvCDRgdC10LrRhtC40Y/QvC5cclxuLy84LiDQn9C10YDQtdC0INGB0LrRgNC+0LvQvtC8INC/0YDQvtCy0LXRgNC40LwsINC10YHRgtGMINC70Lgg0L3QsNGI0LAg0YHQtdC60YbQuNGPXHJcbi8vOS4g0KLQsNGH0L/QsNC0INCz0LXQvdC10YDQuNGA0YPQtdGCINC80L3QvtCz0L4g0YHQvtCx0YvRgtC40LkuINCn0LDRgdGC0YvQtSDRgdC+0LHRi9GC0LjRjy5cclxuLy8xMC4gbW9iYmlsZS1kZXRlY3QganMgLSDQsdC40LHQu9C40L7RgtC10LrQsC4g0L7Qv9GA0LXQtNC10LvQuNGC0Ywg0YPRgdGC0YDQvtC50YHRgtCy0L4g0Lgg0L/RgNC40LzQtdC90LjRgtGMINC80LXRgtC+0LTRi1xyXG5cclxuY29uc3Qgc2VjdGlvbnMgPSAkKFwiLnNlY3Rpb25cIik7XHJcbmNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xyXG5sZXQgaW5TY3JvbGwgPSBmYWxzZTtcclxuY29uc3QgbWQgPSBuZXcgTW9iaWxlRGV0ZWN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcclxuY29uc3QgaXNNb2JpbGUgPSBtZC5tb2JpbGUoKTtcclxuXHJcbmNvbnN0IGNvdW50U2VjdGlvblBvc2l0aW9uID0gKHNlY3Rpb25FcSkgPT4ge1xyXG4gIGNvbnN0IHBvc2l0aW9uID0gc2VjdGlvbkVxICogLTEwMDtcclxuICBpZiAoaXNOYU4ocG9zaXRpb24pKVxyXG4gICAgY29uc29sZS5lcnJvcihcItCd0LUg0LLQtdGA0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0LIg0YTRg9C90LrRhtC40LggY291bnRTZWN0aW9uUG9zaXRpb25cIik7XHJcbiAgcmV0dXJuIHBvc2l0aW9uO1xyXG59O1xyXG5cclxuY29uc3QgcmVzZXRBY3RpdmVDbGFzcyA9IChpdGVtLCBlcSkgPT4ge1xyXG4gIGl0ZW0uZXEoZXEpLmFkZENsYXNzKFwiYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbn07XHJcblxyXG5jb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuICBpZiAoaW5TY3JvbGwpIHJldHVybjtcclxuICBpblNjcm9sbCA9IHRydWU7XHJcbiAgcmVzZXRBY3RpdmVDbGFzcyhzZWN0aW9ucywgc2VjdGlvbkVxKTtcclxuICByZXNldEFjdGl2ZUNsYXNzKCQoXCIucG9pbnQtbmF2X19pdGVtXCIpLCBzZWN0aW9uRXEpO1xyXG4gIGRpc3BsYXkuY3NzKHtcclxuICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHtjb3VudFNlY3Rpb25Qb3NpdGlvbihzZWN0aW9uRXEpfSUpYCxcclxuICB9KTtcclxuXHJcbiAgY29uc3QgdHJhbnNmb3JtRW5kZWQgPSBkaXNwbGF5Lm9uKFwidHJhbnNmb3JtZW5kXCIpLmxlbmd0aDtcclxuICBpZiAodHJhbnNmb3JtRW5kZWQpIHtcclxuICAgIGluU2Nyb2xsID0gZmFsc2U7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3Qgc2Nyb2xsZXIgPSAoKSA9PiB7XHJcbiAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcihcIi5hY3RpdmVcIik7XHJcbiAgY29uc3QgbmV4dFNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLm5leHQoKTtcclxuICBjb25zdCBwcmV2U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ucHJldigpO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgLy/QvtCx0YrQtdC60YIg0YEg0LzQtdGC0L7QtNCw0LzQuFxyXG4gICAgbmV4dCgpIHtcclxuICAgICAgaWYgKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgIC8v0LXRgdC70Lgg0LXRgdGC0Ywg0YHQtdC60YbQuNGPLCDRgdC60YDQvtC70LvQuNC8INC6INC90LXQuVxyXG4gICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKG5leHRTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgcHJldigpIHtcclxuICAgICAgaWYgKHByZXZTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gIH07XHJcbn07XHJcblxyXG4kKHdpbmRvdykub24oXCJ3aGVlbFwiLCAoZSkgPT4ge1xyXG4gIGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XHJcbiAgY29uc3Qgd2luZG93U2Nyb2xsZXIgPSBzY3JvbGxlcigpO1xyXG5cclxuICBpZiAoZGVsdGFZID4gMCkge1xyXG4gICAgd2luZG93U2Nyb2xsZXIubmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgaWYgKGRlbHRhWSA8IDApIHtcclxuICAgIHdpbmRvd1Njcm9sbGVyLnByZXYoKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vINC/0YDQuCDQvdCw0LbQsNGC0LjQuCDQvdCwINC60LvQsNCy0LjRiNC4INCy0LLQtdGA0YUv0LLQvdC40LcvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8v0KPQsdC10LTQuNC80YHRjywg0YfRgtC+INC90LDQttCw0YLQuNC1INC60L3QvtC/0L7QuiDQv9GA0L7QuNC30L7RiNC70L4gYm9keVxyXG4vL9Ce0L/RgNC10LTQtdC70Y/QtdC8INCx0LvQvtC6INGBINC/0YDQvtC40LfQvtGI0LXQtNGI0LjQvCDRgdC+0LHRi9GC0LjQtdC8LiB0YXJnZXQt0LLQvtC30LLRgNCw0YnQsNC10YIg0LHQu9C+0LosINC90LAg0LrQvtGC0L7RgNC+0Lwg0L/RgNC+0LjQt9C+0YjQu9C+INGB0L7QsdGL0YLQuNC1LCDRgdC80L7RgtGA0LXRgtGMINGA0LXQs9C40YHRgtGAXHJcbiQoZG9jdW1lbnQpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xyXG4gIGNvbnN0IHdpbmRvd1Njcm9sbGVyID0gc2Nyb2xsZXIoKTtcclxuICBjb25zdCB0YWdOYW1lID0gZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gIGNvbnN0IHVzZXJUeXBpbmdJbklucHV0cyA9IHRhZ05hbWUgPT09IFwiaW5wdXRcIiB8fCB0YWdOYW1lID09PSBcInRleHRhcmVhXCI7XHJcblxyXG4gIGlmICh1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcclxuICBzd2l0Y2ggKGUua2V5Q29kZSkge1xyXG4gICAgY2FzZSAzODpcclxuICAgICAgd2luZG93U2Nyb2xsZXIucHJldigpO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgNDA6XHJcbiAgICAgIHdpbmRvd1Njcm9sbGVyLm5leHQoKTtcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy/Qv9C10YDQtdGF0L7QtCDQv9C+INGB0YHRi9C70LrQsNC8INC4INGC0L7Rh9C60LDQvC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vL9Cg0LDQt9C90YvQtSDQutC90L7Qv9C60LgsINC/0L4g0LrQvtGC0L7RgNGL0Lwg0L/RgNC+0LjRgdGF0L7QtNGP0YIg0L7QtNC90Lgg0Lgg0YLQtdC20LUg0LTQtdC50YHRgtCy0LjRjy4g0JfQsNCy0L7QtNC40Lwg0LTQsNGC0LAg0LDRgtGA0LjQsdGD0YIgZGF0YS1zY3JvbGwtdG8sINGBINCw0LnQtNC4INC40LvQuCDQutC70LDRgdGB0L7QvC5cclxuLy9lLmN1cnJlbnRUYXJnZXQg0LfQvdCw0YfQtdC90LjQtSDRjdC70LXQvNC10L3RgtCwLCDQvdCwINC60L7RgtC+0YDRi9C5INGB0L7QsdGL0YLQuNC1INCx0YvQu9C+INC90LDQstC10YjQsNC90L5cclxuLy8gYXR0ciDQsdC10YDQtdC8INC90L7QvNC10YAg0YHQtdC60YbQuCDQutGD0LTQsCDRgdC60YDQvtC70LjRgtGMXHJcbiQoXCJbZGF0YS1zY3JvbGwtdG9dXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtc2Nyb2xsLXRvXCIpO1xyXG4gIHBlcmZvcm1UcmFuc2l0aW9uKHRhcmdldCk7XHJcbn0pO1xyXG4vL3RvdWNoc3RhcnQ/IHRvdWNobW92ZSwgdG91Y2hoZW5kIC0g0LzQvtC20L3QviDRgNC10LDQu9C40LfQvtCy0LDRgtGMINC/0LXRgNC10YLRj9Cz0LjQstCw0L3QuNC1ICBkcmFrXHJcbi8vINGA0LXQsNC70LjQt9Cw0YbQuNGPINGBINC/0L7QvNC+0YnRjNGOINCx0LjQsdC70LjQvtGC0LXQutC4ICB0b3VjaHN3aXBlXHJcbi8v0LTQvtCx0LDQstC70Y/QtdC8INGD0YHQu9C+0LLQuNC1INC/0YDQvtCy0LXRgNC60Lgg0YPRgdGC0YDQvtC50YHRgtCy0LBcclxuaWYgKGlzTW9iaWxlKSB7XHJcbiAgJChcImJvZHlcIikuc3dpcGUoe1xyXG4gICAgc3dpcGU6IChldmVudCwgZGlyZWN0aW9uKSA9PiB7XHJcbiAgICAgIGxldCBzY3JvbGxEaXJlY3Rpb247XHJcbiAgICAgIGNvbnN0IHdpbmRvd1Njcm9sbGVyID0gc2Nyb2xsZXIoKTtcclxuXHJcbiAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwidXBcIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7XHJcbiAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwiZG93blwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcInByZXZcIjtcclxuXHJcbiAgICAgIHdpbmRvd1Njcm9sbGVyW3Njcm9sbERpcmVjdGlvbl0oKTtcclxuICAgIH0sXHJcbiAgfSk7XHJcbn1cclxuLy8g0LrQvtC0INC90LUg0LTQvtC70LbQtdC9INGA0LDRgdGC0Lgg0LLQv9GA0LDQstC+LCDQv9C+0L3Rj9GC0L3Ri9C1INC40LzQtdC90LAg0L/QtdGA0LXQvNC10L3QvdGL0YUsINC90LUg0YHQvtC30LTQsNCy0LDRgtGMINC00LvQuNC90L3Ri9GFINGD0YHQvtCy0LjQuSwg0LzQvtC20L3QviDQstGL0L3QtdGB0LvQuCDRg9GB0LvQvtCy0LjQtSDQsiDQv9C10YDQtdC80LXQvdC90YPRjlxyXG4vL9GE0YPQvdC60YbQuNGPINC00L7Qu9C20L3QsCDQstGL0L/QvtC70L3Rj9GC0Ywg0L7QtNC90YMg0L7Qv9C10YDQsNGG0LjRjlxyXG4vL9C/0YDQvtCy0LXRgNGP0YLRjCDQstGF0L7QtNC90YvQtSDQv9Cw0YDQsNC80LXRgtGA0YssINC/0LjRgdCw0YLRjCDQv9C+0LTRgdC60LDQt9C60LhcclxuLy/QstC90YPRgtGA0Lgg0YTRg9C90LrRhtC40Lgg0L/RgNC40LLQvtC00LjRgtGMINCw0YDQs9GD0LzQtdC90YLRiyDQuiDQvdGD0LbQvdGL0Lwg0YLQuNC/0LDQvCDQtNCw0L3QvdGL0YVcclxuLy/QvdC1INC00L7Rg9GB0LrQsNGC0Ywg0LzQsNCz0LjRh9C10YHQutC40YUg0YfQuNGB0LXQu1xyXG4vL9GB0LvQtdC00LjRgtGMINC30LAg0LTRg9Cx0LvQuNC60LDRhtC40LXQuSDQutC+0LTQsFxyXG4iLCJjb25zdCBsZWZ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5sZWZ0X19saW5rXCIpO1xyXG5jb25zdCByaWdodCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmlnaHRfX2xpbmtcIik7XHJcbmNvbnN0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbGlkZXJfX2xpc3RcIik7XHJcblxyXG5yaWdodC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgbG9vcChcInJpZ2h0XCIsIGUpO1xyXG59KTtcclxuXHJcbmxlZnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGxvb3AoXCJsZWZ0XCIsIGUpO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGxvb3AoZGlyZWN0aW9uLCBlKSB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGlmIChkaXJlY3Rpb24gPT09IFwicmlnaHRcIikge1xyXG4gICAgaXRlbXMuYXBwZW5kQ2hpbGQoaXRlbXMuZmlyc3RFbGVtZW50Q2hpbGQpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBpdGVtcy5pbnNlcnRCZWZvcmUoaXRlbXMubGFzdEVsZW1lbnRDaGlsZCwgaXRlbXMuZmlyc3RFbGVtZW50Q2hpbGQpO1xyXG4gIH1cclxufVxyXG4iXX0=
